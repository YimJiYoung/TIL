# 브라우저 내부 동작

## 브라우저 아키텍처

![브라우저 아키텍처](https://d2.naver.com/content/images/2019/03/helloworld-201903-sangwoo-ko_1-08.png)

브라우저는 여러 개의 스레드를 가진 하나의 프로세스 또는 스레드를 조금씩만 사용하는 여러 개의 프로세스로 구현할 수 있다. 크롬은 다중 프로세서 아키텍처를 선택한다. (그러나 하드웨어 성능에 따라 메모리 절약을 위해 하나의 프로세스에서 동작할 수도 있음) 또한 탭마다 렌더러 프로세스를 별도로 할당한다. (정확히는 사이트마다 할당한다고 하지만 이부분은 정확히 이해하지 못함)

</br>

### 각 프로세스의 역할

![브라우저 프로세스](https://d2.naver.com/content/images/2019/03/helloworld-201903-sangwoo-ko_1-09.png)

#### 브라우저 프로세스

- 주소 표시줄, 북마크, 뒤/앞으로 가기 버튼 등 웹 사이트가 표시되는 부분을 제외한 나머지 부분 제어
- 네트워크 요청이나 파일 접근과 같은 권한이 필요한 부분 처리

#### 렌더러 프로세스

- 탭 안에서 웹 사이트가 표시되는 부분의 모든 것 제어

이외에 플러그인 프로세스, GPU 프로세스가 존재

</br>

### 다중 프로세스 아키텍처의 장점과 단점

#### 장점

- 탭마다 독립적인 렌더러 프로세스를 사용하기 때문에 한 탭이 응답하지 않아도 다른 탭 정상적으로 동작

     → 의문점 : 스레드를 사용해도 하나의 스레드가 동작하지 않아도 다른 스레드에 영향은 없지 않나 ?🤔

- 보안과 격리 - 프로세스마다 권한을 설정할 수 있어 다른 프로세스에서 특정 기능에 접근하지 못하도록 제한할  수 있다. (하나의 탭에서 다른 사이트를 표시하는 다른 탭에 접근할 수 있으면 안되겠지 ..)

#### **단점**

- 프로세스는 각자 별도의 주소 공간을 갖기 때문에 공통부분(예: JavaScript 엔진 V8)을 복사해서 가지고 있음→ 메모리 사용량 증가

</br>

## 네비게이션 과정

### 브라우저 프로세스에서 시작

![](https://d2.naver.com/content/images/2019/03/helloworld-201903-sangwoo-ko_2-01.png)

브라우저 프로세스는 브라우저의 버튼과 입력란을 제어하는 UI 스레드, 네트워크 요청을 처리하는 네트워크 스레드, 파일에 대한 접근을 제어하는 스토리지 스레드를 갖고 있다. 주소 표시줄에 URL를 입력하면 UI 스레드가 입력을 처리한다.

### 1. 입력 처리

- UI 스레드는 입력되는 내용이 검색어인지 URL인지 확인한다. 입력 내용에 따라 검색 엔진으로 이동할지 요청된 사이트로 이동할지 결정한다.

### 2. 내비게이션 시작

- 사용자가 Enter 키를 누르면 사이트의 콘텐츠를 가져오기 위해 UI 스레드가 네트워크 호출을 시작한다.
- 네트워크 스레드는 요청에 대한 DNS Lookup 및 TLS 연결 설정과 같은 적절한 프로토콜을 거쳐 요청을 처리한다. (TLS(Transport Layer Security): 인터넷에서의 데이터를 암호화하여 송수신하는 프로토콜)

### 3. 응답 읽기

- 응답이 HTML 파일이라면 데이터를 렌더러 프로세스에 전달하는 단계로 넘어간다. 하지만 응답이 ZIP 형식 파일이나 다른 형식의 파일이라면 다운로드 요청이므로 다운로드 매니저에 데이터를 전달하는 단계로 넘어가야 한다.
- 이 단계는 또한 Safe Browsing의 검사가 실행되는 단계이다. 도메인과 응답 데이터가 악성 사이트로 알려진 사이트와 일치하는 것 같다면 네트워크 스레드는 경고 페이지를 표시하라고 알린다.

### 4. 렌더러 프로세스 찾기

- 모든 검사가 끝나고 브라우저가 요청된 사이트로 이동해야 한다고 네트워크 스레드가 확신하게 되면 네트워크 스레드는 UI 스레드에 데이터가 준비되었음을 알린다. 그러면 UI 스레드는 웹 페이지의 렌더링을 수행할 렌더러 프로세스를 찾는다.

### 5. 네비게이션 실행

![](https://d2.naver.com/content/images/2019/03/helloworld-201903-sangwoo-ko_2-07.png)

- 이제 데이터와 렌더러 프로세스가 준비되었으므로 내비게이션을 실행하도록 브라우저 프로세스에서 렌더러 프로세스로 IPC 메시지를 전송한다. 또한 렌더러 프로세스가 HTML 데이터를 계속 수신할 수 있도록 브라우저 프로세스는 데이터 스트림을 전달한다. 렌더러 프로세스에서 내비게이션이 실행되었다는 것을 브라우저 프로세스가 확인하고 나면 내비게이션이 완료되고 문서 로딩 단계가 시작된다.

## 🔗 참고
[최신 브라우저의 내부 살펴보기 시리즈](https://d2.naver.com/helloworld/2922312)
